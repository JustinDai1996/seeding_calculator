<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="细胞铺板">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/microscope.png">
    <title>Cell Seeding Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; -webkit-tap-highlight-color: transparent; }
        .ios-card { border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); background: white; transition: transform 0.2s; }
        .ios-input { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 16px; background-color: #f9fafb; }
        .ios-input:focus { border-color: #3b82f6; background-color: #fff; outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="pb-20">
<div id="app" class="max-w-md mx-auto p-4 md:max-w-4xl">
    <header class="mb-6 mt-2 flex items-center justify-between">
        <div><h1 class="text-2xl font-bold text-gray-900 tracking-tight">细胞铺板助手</h1><p class="text-xs text-gray-500 font-medium">Lab Assistant</p></div>
        <button @click="resetAll" class="text-sm text-blue-600 font-semibold bg-blue-50 px-3 py-1 rounded-full active:bg-blue-100">重置</button>
    </header>
    <div class="ios-card p-5 mb-5 sticky top-2 z-10 border border-blue-100 ring-1 ring-blue-50 bg-white/95 backdrop-blur-sm">
        <div class="flex items-center mb-3"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3 text-blue-600"><i class="fa-solid fa-vial"></i></div><h2 class="text-lg font-bold text-gray-800">初始悬液浓度</h2></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div><label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Cell A (个/mL)</label><div class="relative"><input type="number" inputmode="decimal" v-model.number="global.concA" placeholder="例如: 150000" class="ios-input font-mono text-lg font-semibold text-blue-800"><span class="absolute right-4 top-3.5 text-gray-400 text-sm">/mL</span></div></div>
            <div v-if="hasMixMode"><label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Cell B (个/mL)</label><div class="relative"><input type="number" inputmode="decimal" v-model.number="global.concB" placeholder="共培养需要" class="ios-input font-mono text-lg font-semibold text-purple-800"><span class="absolute right-4 top-3.5 text-gray-400 text-sm">/mL</span></div></div>
        </div>
    </div>
    <div class="space-y-6">
        <div v-for="(premix, index) in premixes" :key="index" class="ios-card p-5 relative">
            <button @click="removePremix(index)" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 p-2"><i class="fa-solid fa-times text-lg"></i></button>
            <h3 class="text-md font-bold text-gray-700 mb-4 flex items-center"><span class="bg-gray-100 text-gray-500 text-xs px-2 py-1 rounded mr-2">#{{ index + 1 }}</span>配制任务</h3>
            <div class="bg-gray-100 p-1 rounded-lg flex mb-4">
                <button @click="premix.type = 'single'" :class="{'bg-white shadow text-blue-600 font-bold': premix.type === 'single', 'text-gray-500': premix.type !== 'single'}" class="flex-1 py-2 rounded-md text-sm transition-all">Single</button>
                <button @click="premix.type = 'mix'" :class="{'bg-white shadow text-purple-600 font-bold': premix.type === 'mix', 'text-gray-500': premix.type !== 'mix'}" class="flex-1 py-2 rounded-md text-sm transition-all">Mix</button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <div v-if="premix.type === 'mix'" class="col-span-2 md:col-span-4 bg-purple-50 p-3 rounded-xl border border-purple-100 mb-1">
                    <label class="block text-xs font-bold text-purple-600 mb-1">混合比例 (A:B)</label>
                    <div class="flex gap-2"><select v-model="premix.ratioSelect" class="bg-white border border-purple-200 text-gray-700 text-sm rounded-lg block w-full p-2.5"><option value="1:1">1:1</option><option value="3:1">3:1</option><option value="10:1">10:1</option><option value="50:1">50:1</option><option value="custom">自定义</option></select><input v-if="premix.ratioSelect === 'custom'" v-model="premix.ratioCustom" placeholder="5:1" class="w-20 p-2 rounded-lg border border-purple-200 text-center font-mono"></div>
                </div>
                <div><label class="text-xs text-gray-500 mb-1 block">目标/孔</label><input type="number" inputmode="decimal" v-model.number="premix.targetCellsPerWell" class="ios-input bg-gray-50 text-center text-sm"></div>
                <div><label class="text-xs text-gray-500 mb-1 block">体积/孔(mL)</label><input type="number" inputmode="decimal" v-model.number="premix.volPerWell" class="ios-input bg-gray-50 text-center text-sm"></div>
                <div class="col-span-2 md:col-span-2"><label class="text-xs text-gray-500 mb-1 block">孔数 (含余量)</label><div class="flex items-center"><button @click="premix.wells--" class="w-10 h-10 bg-gray-200 rounded-l-lg text-gray-600 font-bold">-</button><input type="number" inputmode="decimal" v-model.number="premix.wells" class="ios-input rounded-none text-center bg-gray-50 border-x-0"><button @click="premix.wells++" class="w-10 h-10 bg-gray-200 rounded-r-lg text-gray-600 font-bold">+</button></div></div>
            </div>
            <div class="bg-slate-800 rounded-xl p-4 text-white shadow-lg mt-4">
                <div v-if="calculate(premix, global).error" class="text-red-300 text-sm font-bold flex items-center"><i class="fa-solid fa-triangle-exclamation mr-2"></i>{{ calculate(premix, global).error }}</div>
                <div v-else class="space-y-3">
                    <div class="flex justify-between items-end border-b border-slate-600 pb-2"><span class="text-slate-400 text-sm">加细胞 A</span><div class="text-right"><div class="text-2xl font-bold text-blue-300 font-mono leading-none">{{ calculate(premix, global).volA }} <span class="text-sm">mL</span></div><div class="text-xs text-slate-500 mt-1">({{ (calculate(premix, global).volA * 1000).toFixed(0) }} µL)</div></div></div>
                    <div v-if="premix.type === 'mix'" class="flex justify-between items-end border-b border-slate-600 pb-2"><span class="text-slate-400 text-sm">加细胞 B</span><div class="text-right"><div class="text-2xl font-bold text-purple-300 font-mono leading-none">{{ calculate(premix, global).volB }} <span class="text-sm">mL</span></div><div class="text-xs text-slate-500 mt-1">({{ (calculate(premix, global).volB * 1000).toFixed(0) }} µL)</div></div></div>
                    <div class="flex justify-between items-end pt-1"><span class="text-slate-400 text-sm font-bold">补培养基</span><div class="text-right"><div class="text-3xl font-bold text-green-400 font-mono leading-none">{{ calculate(premix, global).volMedia }} <span class="text-sm">mL</span></div><div class="text-xs text-slate-500 mt-1">总体系: {{ (premix.wells * premix.volPerWell).toFixed(1) }} mL</div></div></div>
                </div>
            </div>
        </div>
    </div>
    <div class="fixed bottom-6 left-0 right-0 flex justify-center z-20 pointer-events-none"><button @click="addPremix" class="pointer-events-auto bg-blue-600 hover:bg-blue-700 text-white font-bold h-14 w-14 rounded-full shadow-2xl flex items-center justify-center transition transform active:scale-95"><i class="fa-solid fa-plus text-xl"></i></button></div>
    <div class="h-20"></div>
</div>
<script>
    const { createApp, reactive, computed } = Vue;
    createApp({
        setup() {
            const global = reactive({ concA: null, concB: null });
            const premixes = reactive([{ type: 'single', targetCellsPerWell: 50000, volPerWell: 1, wells: 13, ratioSelect: '1:1', ratioCustom: '' }]);
            const hasMixMode = computed(() => premixes.some(p => p.type === 'mix'));
            const addPremix = () => { premixes.push({ type: 'single', targetCellsPerWell: 50000, volPerWell: 1, wells: 13, ratioSelect: '1:1', ratioCustom: '' }); setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100); };
            const removePremix = (index) => { if (premixes.length > 1) premixes.splice(index, 1); };
            const resetAll = () => { if(confirm('重置所有数据？')) { global.concA = null; global.concB = null; premixes.splice(0, premixes.length); addPremix(); } };
            const getRatio = (premix) => { let rString = premix.ratioSelect === 'custom' ? premix.ratioCustom : premix.ratioSelect; if (!rString || !rString.includes(':')) return { a: 1, b: 0 }; const parts = rString.split(':'); return { a: parseFloat(parts[0]) || 0, b: parseFloat(parts[1]) || 0 }; };
            const calculate = (premix, global) => {
                if (!global.concA) return { error: "请输入浓度 A" }; if (premix.type === 'mix' && !global.concB) return { error: "请输入浓度 B" };
                const totalVolNeeded = premix.wells * premix.volPerWell; const totalCellsNeeded = premix.targetCellsPerWell * premix.wells;
                let volA = 0, volB = 0;
                if (premix.type === 'single') { volA = totalCellsNeeded / global.concA; } else { const ratio = getRatio(premix); const totalParts = ratio.a + ratio.b; if (totalParts === 0) return { error: "比例错误" }; volA = (totalCellsNeeded * (ratio.a / totalParts)) / global.concA; volB = (totalCellsNeeded * (ratio.b / totalParts)) / global.concB; }
                const volMedia = totalVolNeeded - volA - volB; if (volMedia < 0) return { error: "浓度太低，需离心" };
                return { volA: volA.toFixed(3), volB: volB.toFixed(3), volMedia: volMedia.toFixed(3), error: null };
            };
            return { global, premixes, addPremix, removePremix, resetAll, calculate, hasMixMode };
        }
    }).mount('#app');
</script>
</body>
</html>
